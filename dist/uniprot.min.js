/*! uniprot 01-06-2015 */
!function(a){"use strict";void 0===a.Uniprot&&(a.Uniprot={}),function(){var b=function(){};b.prototype.datEntries=function(a){var b=/^\/\//,c=[],d="";return a.split("\n").forEach(function(a){return b.test(a)?(c.push(d),void(d="")):void(d+=a+"\n")}),""!==d.trim()&&c.push(d),c},b.prototype.buildCanonicalEntry=function(a){var b=this,d=a===Object(a)?a:b.groupByField(a);return{id:c.id(d),accessionCodes:c.accessionCodes(d),OS:c.OS(d),OC:c.OC(d),sequence:c.sequence(d),ncbi_taxid:c.ncbi_taxid(d),xrefs:c.xrefs(d)}},b.prototype.buildIsoformEntries=function(a){var b=this,e=a===Object(a)?a:b.groupByField(a),f=d(e);void 0===f&&(f=[{id:c.id(e),vsps:[]}]);var g={};return c.features(e).filter(function(a){return"VAR_SEQ"==a.type}).forEach(function(a){if(void 0===a.id)throw{error:"no FTId for ft "+a.comment+" in "+e.ID};if(g[a.id]=a,0===a.comment.indexOf("Missing"))a.replacedBy="";else{var b=/^([A-Z\s]+) \-> ([A-Z\s]+)/.exec(a.comment);if(!b)throw{error:"cannot parse replacement sequence in "+a.comment+" in "+e.ID};a.replacedBy=b[2].replace(/\s+/g,"")}}),f.map(function(a){try{var d=c.id(e),f=a.id,h={OS:c.OS(e),OC:c.OC(e),ncbi_taxid:c.ncbi_taxid(e),isoformOf:d};return(0===a.vsps.length||f==d)&&(h.isCanonical=!0,h.xrefs=c.xrefs(e)),0===a.vsps.length?(h.id=d,h.accessionCodes=c.accessionCodes(e).concat([d,f])):(h.id=f,h.accessionCodes=[f]),h.sequence=b.applyFeaturesVSP(c.sequence(e),a.vsps.map(function(a){if(void 0===g[a]){var b=f+" no VSP feature defined for "+a+" (skipping isoform)";throw console.error(b),{err:b}}return g[a]})),h}catch(i){return void console.error(i)}}).filter(function(a){return void 0!==a})},b.prototype.applyFeaturesVSP=function(a,b){var c=a;return b.sort(function(a,b){return b.start-a.start}).forEach(function(a){c=c.substring(0,a.start)+a.replacedBy+c.substring(a.end+1)}),c},b.prototype.groupByField=function(a){var b=/^([A-Z][A-Z])   (.*)/,c=/^     ([A-Z ]+)$/,d="",e={};return a.split("\n").forEach(function(a){var f=b.exec(a);if(f){var g=f[1],h=f[2];return void 0===e[g]?e[g]="":e[g]+="\n",void(e[g]+=h)}f=c.exec(a),f&&(d+=f[1].replace(/\s+/g,""))}),e.sequence=d,e},b.prototype.getField=function(a,b){return c[b](this.groupByField(a))};var c={id:function(a){return a.ID.split(" ")[0]},accessionCodes:function(a){return a.AC.split(/[\s;]+/).filter(function(a){return""!==a.trim()})},OS:function(a){return a.OS.replace(/\.\s*$/,"")},OC:function(a){return a.OC.replace(/\.\s*$/,"").split(/;\s*/).filter(function(a){return""!==a.trim()})},sequence:function(a){return a.sequence},ncbi_taxid:function(a){var b=a.OX,c=/^NCBI_TaxID=(\d*)(?:\s.*)?;$/,d=c.exec(b);if(!d)throw a.ID+": cannot extract ncbi_taxid from["+b+"]";return parseInt(d[1],10)},cces:function(a){var b={};return("\n"+a.CC).split("\n-!- ").forEach(function(a){var c=a.indexOf(":"),d=a.substr(0,c),e=a.substr(c+2).trim().replace(/^\s+/,"");void 0===b[d]?b[d]=e:b[d].substring?b[d]=[b[d],e]:b[d].push(e)}),b},features:function(a){var b,c=[],d=/(\w+)\s+(\d+)\s+(\d+)\s*(.*)/;return(a.FT||"").split("\n").forEach(function(a){var e=d.exec(a);e?(b={type:e[1],start:parseInt(e[2],10)-1,end:parseInt(e[3],10)-1,comment:e[4]},c.push(b)):b&&(b.comment+=" "+a.replace(/^\s+/,""))}),c.forEach(function(a){var b=/\/FTId=(\w+)\.$/.exec(a.comment);b&&(a.id=b[1])}),c},xrefs:function(a){var b=a.DR.split("\n").map(function(a){return a.replace(/\.$/,"").split("; ")}).filter(function(a){return"PDB"===a[0]}).map(function(a){return{id:a[1],method:a[2],resolution:a[3],chains:a[4].split(", ").map(function(a){var b=/(.*)=(\d+)\-(\d+)/.exec(a);return b?{name:b[1],start:b[2]-1,end:b[3]-1}:void 0}).filter(function(a){return void 0!==a})}});return{PDB:b}}},d=function(a){var b=c.cces(a)["ALTERNATIVE PRODUCTS"];if(void 0===b)return void 0;for(var d,e=/ IsoId=(\S+); Sequence=([\s\S]*?);/g,f=[];d=e.exec(b);)if(!/External|Not described/.test(d[2])){var g=d[2].split(/,\s*/);1==g.length&&"Displayed"==g[0]&&(g=[]),f.push({id:d[1],vsps:g})}return f};"undefined"!=typeof exports&&(exports.Reader=b),a.Uniprot.Reader=b}()}(this);